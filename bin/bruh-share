#!/usr/bin/bash
set -euo pipefail

_panic() {
    printf '%s\n' "$@"
    exit 1
}

MOUNT=/bruh
[[ ! -d "$MOUNT" ]] && _panic "Error, share partition not mounted to $MOUNT!"

spath="${1:-}"

[[ ! -e $spath ]] && _panic "Error, path does not exist! '$spath'"
[[ $spath != $HOME/* ]] && _panic "Error, path '$spath' is not in the home directory!"

# a dumb decision I made when starting this whole sharepart thing was making .local point to local, because I did not want dotfiles.
case $spath in
"$HOME/.local"*)
    dest="${spath/$HOME\/.local/$MOUNT/home/local}"
    ;;
"$HOME/.config"*)
    dest="${spath/$HOME\/.config/$MOUNT/home/config}"
    ;;
*)
    dest="${spath/$HOME/$MOUNT/home}"
    ;;
esac

[[ -e "$dest" ]] && _panic "Error, destination '$dest' already exists!"

echo "Linking paths

$spath
to
$dest
"
read -rp 'Accept? [y/N] > ' ans

[[ "${ans:-}" == y ]] || _panic '' "Not linking path $spath"

echo '
linking'

mv "$spath" "$dest"
ln -s "$dest" "$spath"

echo "Successfully linked"
