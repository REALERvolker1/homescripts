#!/usr/bin/bash
# vlk's pacs, an actually good search functionality for Arch Linux pacman based on dnfs
set -euo pipefail
IFS=$'\n\t'

if command -v yay &>/dev/null; then
    _pk() {
        yay "$@"
    }
elif command -v pacman &>/dev/null; then
    _pk() {
        pacman "$@"
    }
else
    echo "Error, you must have Arch Linux \`yay\` or \`pacman\` installed to use this program!"
    exit 1
fi
cosmetic_sedstr='s/-git /\x1b[1m-git\x1b[0m /g
'
repo_sedstr='s/aur/\x1b[96mAUR\x1b[0m/g
s/core/\x1b[94mCORE\x1b[0m/g
s/extra/\x1b[95mEXTRA\x1b[0m/g
s/g14/\x1b[91mASUS\x1b[0m/g
s/multilib/\x1b[93mMULTILIB\x1b[0m/g'
# installed_list="$(_pk -Q)"

# grep -v '\[installed\]$' | awk '{print "[",$1,"]",$2,"[",$3,"]"}'
package_list="$(_pk -Sl | grep -v '\[installed\]$')"
# echo "$package_list" | sed "$cosmetic_sedstr"

repo_width="$(echo "$package_list" | cut -d ' ' -f 1 | uniq | wc -L)"

for line in $package_list; do
    repo="$(echo "${line## *}" | sed "$repo_sedstr")"
    printf '%sh\n' "$repo"
done
echo "$repo_width"
# echo "$package_list" | cut -d ' ' -f 1 | uniq
